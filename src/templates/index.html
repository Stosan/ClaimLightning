<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ClaimLightning â€” Secure Login</title>
  <meta name="color-scheme" content="light dark" />
  <style>
    :root {
      --bg: #0f172a;            /* slate-900 */
      --card: #111827;          /* gray-900 */
      --text: #e5e7eb;          /* gray-200 */
      --muted: #94a3b8;         /* slate-400 */
      --primary: #6750A4;       /* Material 3 primary */
      --primary-variant: #7f67be;
      --on-primary: #fff;
      --error: #ef4444;         /* red-500 */
      --ok: #22c55e;            /* green-500 */
      --outline: #334155;       /* slate-700 */
      --surface: #0b1220;       /* near bg */
      --shadow: 0 10px 30px rgba(0,0,0,.35), 0 2px 8px rgba(0,0,0,.3);
      --radius: 16px;
    }

    /* Light mode */
    @media (prefers-color-scheme: light) {
      :root {
        --bg: #f7f7fb;
        --card: #ffffff;
        --text: #0b1020;
        --muted: #5f6b7a;
        --primary: #6750A4;
        --primary-variant: #7f67be;
        --on-primary: #fff;
        --outline: #e5e7eb;
        --surface: #ffffff;
        --shadow: 0 10px 30px rgba(17, 24, 39, .12), 0 2px 8px rgba(17,24,39,.08);
      }
    }

    html, body {
      height: 100%;
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Noto Sans", "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 600px at 10% 10%, rgba(103,80,164,.15), transparent 60%),
                  radial-gradient(1000px 500px at 90% 20%, rgba(127,103,190,.12), transparent 60%),
                  var(--bg);
      color: var(--text);
    }

    .container {
      min-height: 100%;
      display: grid;
      place-items: center;
      padding: 24px;
    }

    .card {
      width: 100%;
      max-width: 440px;
      background: linear-gradient(180deg, var(--card), var(--surface));
      border: 1px solid var(--outline);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      position: relative;
      isolation: isolate;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: -1px;
      pointer-events: none;
      background: radial-gradient(600px 200px at 10% -10%, rgba(103,80,164,.25), transparent 60%),
                  radial-gradient(500px 150px at 110% 0%, rgba(127,103,190,.18), transparent 60%);
      mask: linear-gradient(#000, transparent 60%);
      z-index: -1;
    }

    .header {
      display: grid;
      gap: 6px;
      padding: 28px 28px 8px 28px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo {
      width: 44px; height: 44px;
      border-radius: 12px;
      background: conic-gradient(from 210deg, #7f67be, #6750A4, #9b87f5, #7f67be);
      position: relative;
      box-shadow: 0 6px 16px rgba(103,80,164,.35), inset 0 0 0 1px rgba(255,255,255,.08);
    }
    .logo::after { /* lightning glyph */
      content: "";
      position: absolute;
      inset: 9px 12px 9px 16px;
      background: linear-gradient(180deg, #fff, #e2e8f0);
      clip-path: polygon(60% 0%, 40% 40%, 70% 40%, 35% 100%, 45% 55%, 20% 55%);
      filter: drop-shadow(0 1px 1px rgba(0,0,0,.25));
    }

    h1 {
      margin: 0;
      font-size: 1.35rem;
      letter-spacing: .2px;
    }
    .subtitle {
      margin: 0;
      color: var(--muted);
      font-size: .96rem;
    }

    .content {
      padding: 18px 28px 28px 28px;
      display: grid;
      gap: 16px;
    }

    .field {
      position: relative;
    }

    .input {
      width: 100%;
      font-size: 1rem;
      padding: 22px 48px 8px 16px; /* leave space for icons */
      border: 1px solid var(--outline);
      border-radius: 12px;
      background: color-mix(in oklab, var(--surface) 92%, transparent);
      color: var(--text);
      transition: border-color .2s ease, box-shadow .2s ease, background .2s ease;
      outline: none;
    }

    .input:focus {
      border-color: color-mix(in oklab, var(--primary) 65%, #ffffff 0%);
      box-shadow: 0 0 0 4px color-mix(in oklab, var(--primary) 22%, transparent);
      background: color-mix(in oklab, var(--surface) 98%, transparent);
    }

    .label {
      position: absolute;
      left: 14px;
      top: 12px;
      font-size: .9rem;
      color: var(--muted);
      pointer-events: none;
      transition: transform .15s ease, color .15s ease, font-size .15s ease, top .15s ease;
      background: transparent;
      padding: 0 4px;
    }

    .input:focus + .label,
    .input:not(:placeholder-shown) + .label {
      transform: translateY(-12px);
      top: 6px;
      font-size: .74rem;
      color: color-mix(in oklab, var(--primary) 75%, var(--muted));
    }

    .trailing-icon, .leading-icon {
      position: absolute;
      inset: 0;
      pointer-events: none;
    }
    .trailing-icon svg, .leading-icon svg {
      position: absolute;
      top: 50%; transform: translateY(-50%);
      width: 20px; height: 20px;
      opacity: .8;
    }
    .trailing-icon svg { right: 12px; }
    .leading-icon svg { left: 12px; }

    .password-toggle {
      position: absolute; right: 8px; top: 50%; transform: translateY(-50%);
      border: 0; background: transparent; color: var(--muted);
      cursor: pointer; padding: 6px; border-radius: 8px;
    }
    .password-toggle:focus-visible { outline: 2px solid color-mix(in oklab, var(--primary) 60%, transparent); }

    .row {
      display: flex; align-items: center; justify-content: space-between; gap: 12px;
      margin-top: 4px;
    }

    .helper { color: var(--muted); font-size: .85rem; }

    .error { color: var(--error); font-size: .9rem; display: none; }
    .error.show { display: block; animation: pop .15s ease; }

    @keyframes pop { from { transform: translateY(-2px); opacity: .5; } to { transform: translateY(0); opacity: 1; } }

    .actions { display: grid; gap: 12px; margin-top: 4px; }

    .btn {
      position: relative;
      display: inline-flex; align-items: center; justify-content: center;
      gap: 10px;
      width: 100%;
      border: 0; border-radius: 14px;
      padding: 14px 18px;
      background: linear-gradient(180deg, var(--primary), var(--primary-variant));
      color: var(--on-primary);
      font-weight: 600;
      letter-spacing: .2px;
      cursor: pointer;
      overflow: hidden;
      box-shadow: 0 8px 18px rgba(103,80,164,.35);
      transition: transform .06s ease, filter .15s ease;
    }
    .btn:active { transform: translateY(1px) scale(.995); }
    .btn[disabled] { filter: grayscale(.3) brightness(.8); cursor: not-allowed; box-shadow: none; }

    /* Ripple */
    .btn .ripple {
      position: absolute; border-radius: 999px; pointer-events: none; transform: translate(-50%, -50%);
      background: rgba(255,255,255,.35);
      animation: ripple .6s ease-out;
    }
    @keyframes ripple { from { width: 0; height: 0; opacity: .6; } to { width: 420px; height: 420px; opacity: 0; } }

    .footer-note { text-align: center; color: var(--muted); font-size: .82rem; }

    .spinner {
      width: 18px; height: 18px; border-radius: 999px;
      border: 2.5px solid rgba(255,255,255,.35);
      border-top-color: #fff;
      animation: spin .9s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    .sr-only {
      position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 1px, 1px); white-space: nowrap; border: 0;
    }
  </style>
</head>
<body>
  <main class="container">
    <section class="card" role="region" aria-labelledby="login-title">
      <header class="header">
        <div class="brand">
          <div class="logo" aria-hidden="true"></div>
          <div>
            <h1 id="login-title">ClaimLightning AI</h1>
            <p class="subtitle" style="font-size: small;">AI-Powered Claim Processing for Insurance Workflows</p>
            <!-- <p class="subtitle" style="font-size: small;">Secure access to your claims portal</p> -->
          </div>
        </div>
      </header>

      <form id="login-form" class="content" novalidate>
        <p id="policy-help" class="helper">Enter your alphanumeric policy ID (e.g., ALS-13945)</p>

        <div class="field">
          <input
            id="policyNumber"
            name="policyNumber"
            class="input"
            type="text"
            inputmode="numeric"
            autocomplete="username"
            required
            minlength="5"
            placeholder=" "
            aria-describedby="policy-help"
            aria-invalid="false"
            pattern="[A-Za-z0-9\-]{5,}"
          />
          <label for="policyNumber" class="label">Policy Number</label>
       
        </div>
     
        <div class="field">
          <input
            id="password"
            name="password"
            class="input"
            type="password"
            autocomplete="current-password"
            required
            minlength="6"
            placeholder=" "
            aria-invalid="false"
          />
          <label for="password" class="label">Password</label>
          <button type="button" class="password-toggle" aria-label="Toggle password visibility" title="Show/Hide password">
            <svg id="eye-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" width="22" height="22">
              <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7z"/>
              <circle cx="12" cy="12" r="3"/>
            </svg>
          </button>
        </div>

        <div class="row">
          <span class="helper">Use the credentials shared during registration.</span>
          <a href="#" class="helper" style="text-decoration: none;">Forgot?</a>
        </div>

        <p class="error" id="error-msg" role="alert"></p>

        <div class="actions">
          <button id="submit" class="btn" type="submit">
            <span id="btn-label">Continue</span>
          </button>
          <p class="footer-note">By continuing you agree to our <a href="#" style="color: inherit; opacity: .9;">Terms</a> &amp; <a href="#" style="color: inherit; opacity: .9;">Privacy</a>.</p>
        </div>
      </form>
    </section>
  </main>

  <script>
    (function() {
      const form = document.getElementById('login-form');
      const policyInput = document.getElementById('policyNumber');
      const passwordInput = document.getElementById('password');
      const errorMsg = document.getElementById('error-msg');
      const submitBtn = document.getElementById('submit');
      const btnLabel = document.getElementById('btn-label');

      // Button ripple effect
      submitBtn.addEventListener('click', (e) => {
        const rect = submitBtn.getBoundingClientRect();
        const ripple = document.createElement('span');
        ripple.className = 'ripple';
        ripple.style.left = (e.clientX - rect.left) + 'px';
        ripple.style.top = (e.clientY - rect.top) + 'px';
        submitBtn.appendChild(ripple);
        setTimeout(() => ripple.remove(), 600);
      });

      // Toggle password visibility
      document.querySelector('.password-toggle').addEventListener('click', () => {
        const isPwd = passwordInput.type === 'password';
        passwordInput.type = isPwd ? 'text' : 'password';
        const eye = document.getElementById('eye-icon');
        if (isPwd) {
          // Eye-off glyph
          eye.innerHTML = '<path d="M17.94 17.94A10.94 10.94 0 0 1 12 20c-7 0-11-8-11-8a20.56 20.56 0 0 1 5.06-6.06M9.9 4.24A10.94 10.94 0 0 1 12 4c7 0 11 8 11 8a20.56 20.56 0 0 1-4.87 5.94"/><line x1="1" y1="1" x2="23" y2="23" />';
        } else {
          eye.innerHTML = '<path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7z"/><circle cx="12" cy="12" r="3"/>';
        }
      });

      function setLoading(loading) {
        submitBtn.disabled = loading;
        if (loading) {
          btnLabel.innerHTML = '<span class="spinner" aria-hidden="true"></span><span class="sr-only">Loadingâ€¦</span>';
        } else {
          btnLabel.textContent = 'Continue';
        }
      }

      function showError(msg) {
        errorMsg.textContent = msg;
        errorMsg.classList.add('show');
      }

      function clearError() {
        errorMsg.textContent = '';
        errorMsg.classList.remove('show');
      }

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        clearError();

        // Simple client validation
        const policy = policyInput.value.trim();
        const pwd = passwordInput.value;
        policyInput.setAttribute('aria-invalid', 'false');
        passwordInput.setAttribute('aria-invalid', 'false');

        if (!policy || !policyInput.checkValidity()) {
          policyInput.focus();
          policyInput.setAttribute('aria-invalid', 'true');
          return showError('Enter a valid policy number (min 5 characters, letters/numbers/dashes).');
        }
        if (!pwd || pwd.length < 6) {
          passwordInput.focus();
          passwordInput.setAttribute('aria-invalid', 'true');
          return showError('Password must be at least 6 characters.');
        }

        setLoading(true);
        try {
          const res = await fetch('http://127.0.0.1:8000/api/v1/verify-customer', {
            method: 'POST',
            headers: { 
              'Content-Type': 'application/json',
              'X-API-KEY': 'blemisshes'
            },
            body: JSON.stringify({ policyNumber: policy, password: pwd })
          });

          if (res.status === 200) {
            // Optionally read token or message
            try {
              const data = await res.json().catch(() => null);
              if (data && data.token) {
                sessionStorage.setItem('cl_token', data.token);
                sessionStorage.setItem('cl_policy', data.policyNumber);
              }
            } catch (_) {}
            window.location.href = '/claim-application';
          } else if (res.status === 401) {
            showError('Invalid credentials. Doubleâ€‘check policy number or password.');
          } else if (res.status === 404) {
            showError('Policy not found. Confirm your policy number.');
          } else {
            const text = await res.text().catch(() => '');
            showError(`Login failed (${res.status}). ${text || 'Please try again.'}`);
          }
        } catch (err) {
          console.error(err);
          showError('Network error. Check your connection and try again.');
        } finally {
          setLoading(false);
        }
      });
    })();
  </script>
</body>
</html>
